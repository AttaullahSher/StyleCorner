<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>StyleCorner - Mobile</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
</head>
<body class="bg-gray-100 font-sans">
  <header class="bg-blue-700 text-white p-3 sticky top-0 z-10 shadow-md">
    <div class="flex justify-between items-center max-w-4xl mx-auto">
      <h1 class="text-lg font-bold flex items-center">
        <i class="fas fa-tshirt mr-2"></i> StyleCorner
      </h1>
      <button id="menuToggle" class="text-2xl"><i class="fas fa-bars"></i></button>
    </div>
  </header>
  <div id="menu" class="hidden max-w-4xl mx-auto bg-white p-3 shadow-md">
    <nav class="flex flex-col space-y-2">
      <a href="#partners" class="text-blue-700 hover:bg-blue-50 p-2 rounded flex items-center"><i class="fas fa-users mr-2"></i> Partners</a>
      <a href="#inventory" class="text-blue-700 hover:bg-blue-50 p-2 rounded flex items-center"><i class="fas fa-box mr-2"></i> Inventory</a>
      <a href="#purchase" class="text-blue-700 hover:bg-blue-50 p-2 rounded flex items-center"><i class="fas fa-shopping-cart mr-2"></i> Add Purchase</a>
      <a href="#sale" class="text-blue-700 hover:bg-blue-50 p-2 rounded flex items-center"><i class="fas fa-money-bill mr-2"></i> Add Sale</a>
      <a href="#refund" class="text-blue-700 hover:bg-blue-50 p-2 rounded flex items-center"><i class="fas fa-undo mr-2"></i> Add Refund</a>
      <a href="#expense" class="text-blue-700 hover:bg-blue-50 p-2 rounded flex items-center"><i class="fas fa-wallet mr-2"></i> Add Expense</a>
      <a href="#transactions" class="text-blue-700 hover:bg-blue-50 p-2 rounded flex items-center"><i class="fas fa-list mr-2"></i> Transactions</a>
    </nav>
  </div>
  <div class="container mx-auto p-3 max-w-4xl">
    <!-- Partners' Shares -->
    <div id="partners" class="mb-4">
      <h2 class="text-lg font-semibold mb-3 text-blue-800 flex items-center"><i class="fas fa-users mr-2"></i> Partners' Shares</h2>
      <div class="grid grid-cols-1 gap-3" id="partnersList"></div>
      <p class="mt-3 text-blue-800 text-sm flex items-center"><i class="fas fa-coins mr-2"></i> Total Cash: <span id="totalCash" class="font-bold ml-1">0 PKR</span></p>
    </div>

    <!-- Inventory -->
    <div id="inventory" class="mb-4">
      <h2 class="text-lg font-semibold mb-3 text-blue-800 flex items-center"><i class="fas fa-box mr-2"></i> Inventory</h2>
      <div class="grid grid-cols-1 gap-3" id="inventoryList"></div>
    </div>

    <!-- Add Purchase -->
    <div id="purchase" class="mb-4">
      <h2 class="text-lg font-semibold mb-3 text-blue-800 flex items-center"><i class="fas fa-shopping-cart mr-2"></i> Add Purchase</h2>
      <div class="bg-white p-4 rounded-lg shadow-md">
        <div class="grid grid-cols-1 gap-3">
          <div>
            <label class="block text-xs font-medium text-gray-700">Category</label>
            <select id="purchaseCategory" class="border p-2 rounded w-full text-sm">
              <option value="Male Unstitched">Male Unstitched</option>
              <option value="Female Unstitched">Female Unstitched</option>
              <option value="Male Stitched">Male Stitched</option>
              <option value="Female Stitched">Female Stitched</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Quantity</label>
            <input id="purchaseQuantity" type="number" placeholder="Quantity" class="border p-2 rounded w-full text-sm" min="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Amount (PKR)</label>
            <input id="purchaseAmount" type="number" placeholder="Amount" class="border p-2 rounded w-full text-sm" min="0" step="0.01">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Supplier Name</label>
            <input id="purchaseSupplier" type="text" placeholder="Supplier Name" class="border p-2 rounded w-full text-sm">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Receipt (Optional)</label>
            <input id="purchaseReceipt" type="file" accept=".pdf,.jpg,.png" class="border p-2 rounded w-full text-sm">
          </div>
          <button onclick="addPurchase()" class="bg-blue-500 text-white p-3 rounded-lg hover:bg-blue-600 transition text-sm flex items-center justify-center"><i class="fas fa-plus mr-2"></i> Add Purchase</button>
        </div>
      </div>
    </div>

    <!-- Add Sale -->
    <div id="sale" class="mb-4">
      <h2 class="text-lg font-semibold mb-3 text-blue-800 flex items-center"><i class="fas fa-money-bill mr-2"></i> Add Sale</h2>
      <div class="bg-white p-4 rounded-lg shadow-md">
        <div class="grid grid-cols-1 gap-3">
          <div>
            <label class="block text-xs font-medium text-gray-700">Category</label>
            <select id="saleCategory" class="border p-2 rounded w-full text-sm">
              <option value="Male Unstitched">Male Unstitched</option>
              <option value="Female Unstitched">Female Unstitched</option>
              <option value="Male Stitched">Male Stitched</option>
              <option value="Female Stitched">Female Stitched</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Quantity</label>
            <input id="saleQuantity" type="number" placeholder="Quantity" class="border p-2 rounded w-full text-sm" min="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Amount (PKR)</label>
            <input id="saleAmount" type="number" placeholder="Amount" class="border p-2 rounded w-full text-sm" min="0" step="0.01">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Customer Name</label>
            <input id="saleCustomer" type="text" placeholder="Customer Name" class="border p-2 rounded w-full text-sm">
          </div>
          <button onclick="addSale()" class="bg-green-500 text-white p-3 rounded-lg hover:bg-green-600 transition text-sm flex items-center justify-center"><i class="fas fa-plus mr-2"></i> Add Sale</button>
        </div>
      </div>
    </div>

    <!-- Add Refund -->
    <div id="refund" class="mb-4">
      <h2 class="text-lg font-semibold mb-3 text-blue-800 flex items-center"><i class="fas fa-undo mr-2"></i> Add Refund</h2>
      <div class="bg-white p-4 rounded-lg shadow-md">
        <div class="grid grid-cols-1 gap-3">
          <div>
            <label class="block text-xs font-medium text-gray-700">Category</label>
            <select id="refundCategory" class="border p-2 rounded w-full text-sm">
              <option value="Male Unstitched">Male Unstitched</option>
              <option value="Female Unstitched">Female Unstitched</option>
              <option value="Male Stitched">Male Stitched</option>
              <option value="Female Stitched">Female Stitched</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Quantity</label>
            <input id="refundQuantity" type="number" placeholder="Quantity" class="border p-2 rounded w-full text-sm" min="1">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Amount (PKR)</label>
            <input id="refundAmount" type="number" placeholder="Amount" class="border p-2 rounded w-full text-sm" min="0" step="0.01">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Customer Name</label>
            <input id="refundCustomer" type="text" placeholder="Customer Name" class="border p-2 rounded w-full text-sm">
          </div>
          <button onclick="addRefund()" class="bg-yellow-500 text-white p-3 rounded-lg hover:bg-yellow-600 transition text-sm flex items-center justify-center"><i class="fas fa-plus mr-2"></i> Add Refund</button>
        </div>
      </div>
    </div>

    <!-- Add Expense -->
    <div id="expense" class="mb-4">
      <h2 class="text-lg font-semibold mb-3 text-blue-800 flex items-center"><i class="fas fa-wallet mr-2"></i> Add Expense</h2>
      <div class="bg-white p-4 rounded-lg shadow-md">
        <div class="grid grid-cols-1 gap-3">
          <div>
            <label class="block text-xs font-medium text-gray-700">Type</label>
            <select id="expenseType" class="border p-2 rounded w-full text-sm">
              <option value="Stitching">Stitching</option>
              <option value="Courier">Courier</option>
              <option value="Marketing">Marketing</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Amount (PKR)</label>
            <input id="expenseAmount" type="number" placeholder="Amount" class="border p-2 rounded w-full text-sm" min="0" step="0.01">
          </div>
          <div>
            <label class="block text-xs font-medium text-gray-700">Receipt (Optional)</label>
            <input id="expenseReceipt" type="file" accept=".pdf,.jpg,.png" class="border p-2 rounded w-full text-sm">
          </div>
          <button onclick="addExpense()" class="bg-red-500 text-white p-3 rounded-lg hover:bg-red-600 transition text-sm flex items-center justify-center"><i class="fas fa-plus mr-2"></i> Add Expense</button>
        </div>
      </div>
    </div>

    <!-- Transactions -->
    <div id="transactions">
      <h2 class="text-lg font-semibold mb-3 text-blue-800 flex justify-between items-center">
        <span><i class="fas fa-list mr-2"></i> Transactions</span>
        <button id="toggleTransactions" class="text-blue-700 text-sm">Hide</button>
      </h2>
      <div id="transactionsList" class="space-y-3"></div>
    </div>
  </div>

  <script>
    const partners = [
      { name: "Hafsa", investment: 25000 },
      { name: "Talha", investment: 25000 },
      { name: "Waseem", investment: 25000 },
      { name: "Atta", investment: 25000 }
    ];
    const PASSWORD = "2532";
    let totalCash = partners.reduce((sum, p) => sum + p.investment, 0);
    let inventory = [];
    let transactions = [];
    let expenses = [];

    // Load data from CSV files (mock for local development)
    function loadData() {
      inventory = [
        { category: "Male Unstitched", quantity: 0, total_value: 0 },
        { category: "Female Unstitched", quantity: 0, total_value: 0 },
        { category: "Male Stitched", quantity: 0, total_value: 0 },
        { category: "Female Stitched", quantity: 0, total_value: 0 }
      ];
      updateUI();
    }

    // Update UI
    function updateUI() {
      // Partners
      const totalInvestment = partners.reduce((sum, p) => sum + p.investment, 0);
      const profit = totalCash - totalInvestment - expenses.reduce((sum, e) => sum + e.amount, 0);
      const partnersHtml = partners.map(p => `
        <div class="bg-white p-3 rounded-lg shadow-md flex items-center">
          <i class="fas fa-user text-blue-700 mr-2"></i>
          <div>
            <p class="font-semibold text-blue-800 text-sm">${p.name}</p>
            <p class="text-sm">Investment: ${p.investment.toFixed(2)} PKR</p>
            <p class="text-sm font-bold">Share: ${((p.investment / totalInvestment) * (profit + totalInvestment)).toFixed(2)} PKR</p>
          </div>
        </div>
      `).join("");
      document.getElementById("partnersList").innerHTML = partnersHtml;
      document.getElementById("totalCash").textContent = `${totalCash.toFixed(2)} PKR`;

      // Inventory
      const inventoryHtml = inventory.map(item => `
        <div class="bg-white p-3 rounded-lg shadow-md flex items-center">
          <i class="fas fa-tshirt text-blue-700 mr-2"></i>
          <div>
            <p class="font-medium text-blue-800 text-sm">${item.category}</p>
            <p class="text-sm">Quantity: ${item.quantity}</p>
            <p class="text-sm">Value: ${item.total_value.toFixed(2)} PKR</p>
          </div>
        </div>
      `).join("");
      document.getElementById("inventoryList").innerHTML = inventoryHtml;

      // Transactions (sorted by date descending)
      const allTransactions = [
        ...transactions,
        ...expenses.map(e => ({
          type: "Expense",
          category: "",
          quantity: "",
          amount: e.amount,
          date: e.date,
          name: e.type,
          receipt: e.receipt
        }))
      ].sort((a, b) => new Date(b.date) - new Date(a.date));

      const transactionsHtml = allTransactions.map((t, index) => `
        <div class="bg-white p-3 rounded-lg shadow-md flex flex-col sm:flex-row sm:justify-between sm:items-center">
          <div class="text-sm">
            <p class="font-medium text-blue-800 flex items-center">
              <i class="fas ${t.type === 'Purchase' ? 'fa-shopping-cart' : t.type === 'Sale' ? 'fa-money-bill' : t.type === 'Refund' ? 'fa-undo' : 'fa-wallet'} mr-2"></i>
              ${t.type}
            </p>
            ${t.category ? `<p>Category: ${t.category}</p>` : ""}
            ${t.quantity ? `<p>Quantity: ${t.quantity}</p>` : ""}
            <p>Amount: ${t.amount.toFixed(2)} PKR</p>
            <p>Date: ${t.date}</p>
            <p>Name: ${t.name}</p>
            ${t.receipt ? `<p>Receipt: ${t.receipt}</p>` : ""}
          </div>
          <button onclick="deleteTransaction(${index})" class="mt-2 sm:mt-0 bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition text-sm flex items-center"><i class="fas fa-trash mr-2"></i> Delete</button>
        </div>
      `).join("");
      document.getElementById("transactionsList").innerHTML = transactionsHtml;
    }

    // Add Purchase
    function addPurchase() {
      const category = document.getElementById("purchaseCategory").value;
      const quantity = parseInt(document.getElementById("purchaseQuantity").value);
      const amount = parseFloat(document.getElementById("purchaseAmount").value);
      const supplier = document.getElementById("purchaseSupplier").value;
      const receipt = document.getElementById("purchaseReceipt").files[0];

      if (category && quantity > 0 && amount > 0 && supplier) {
        let item = inventory.find(i => i.category === category);
        if (!item) {
          item = { category, quantity: 0, total_value: 0 };
          inventory.push(item);
        }
        item.quantity += quantity;
        item.total_value += amount;

        transactions.push({
          type: "Purchase",
          category,
          quantity,
          amount,
          date: new Date().toISOString().split("T")[0],
          name: supplier,
          receipt: receipt ? receipt.name : "None"
        });

        totalCash -= amount;
        console.log("Receipt uploaded:", receipt ? receipt.name : "None");
        saveToCSV();
        updateUI();

        document.getElementById("purchaseCategory").value = "Male Unstitched";
        document.getElementById("purchaseQuantity").value = "";
        document.getElementById("purchaseAmount").value = "";
        document.getElementById("purchaseSupplier").value = "";
        document.getElementById("purchaseReceipt").value = "";
      } else {
        alert("Please fill all fields correctly.");
      }
    }

    // Add Sale
    function addSale() {
      const category = document.getElementById("saleCategory").value;
      const quantity = parseInt(document.getElementById("saleQuantity").value);
      const amount = parseFloat(document.getElementById("saleAmount").value);
      const customer = document.getElementById("saleCustomer").value;

      if (category && quantity > 0 && amount > 0 && customer) {
        const item = inventory.find(i => i.category === category);
        if (!item || item.quantity < quantity) {
          alert("Insufficient inventory!");
          return;
        }

        item.quantity -= quantity;
        item.total_value -= (item.total_value / (item.quantity + quantity)) * quantity;

        transactions.push({
          type: "Sale",
          category,
          quantity,
          amount,
          date: new Date().toISOString().split("T")[0],
          name: customer
        });

        totalCash += amount;
        saveToCSV();
        updateUI();

        document.getElementById("saleCategory").value = "Male Unstitched";
        document.getElementById("saleQuantity").value = "";
        document.getElementById("saleAmount").value = "";
        document.getElementById("saleCustomer").value = "";
      } else {
        alert("Please fill all fields correctly.");
      }
    }

    // Add Refund
    function addRefund() {
      const category = document.getElementById("refundCategory").value;
      const quantity = parseInt(document.getElementById("refundQuantity").value);
      const amount = parseFloat(document.getElementById("refundAmount").value);
      const customer = document.getElementById("refundCustomer").value;

      if (category && quantity > 0 && amount > 0 && customer) {
        let item = inventory.find(i => i.category === category);
        if (!item) {
          item = { category, quantity: 0, total_value: 0 };
          inventory.push(item);
        }
        item.quantity += quantity;
        item.total_value += amount;

        transactions.push({
          type: "Refund",
          category,
          quantity,
          amount,
          date: new Date().toISOString().split("T")[0],
          name: customer
        });

        totalCash -= amount;
        saveToCSV();
        updateUI();

        document.getElementById("refundCategory").value = "Male Unstitched";
        document.getElementById("refundQuantity").value = "";
        document.getElementById("refundAmount").value = "";
        document.getElementById("refundCustomer").value = "";
      } else {
        alert("Please fill all fields correctly.");
      }
    }

    // Add Expense
    function addExpense() {
      const type = document.getElementById("expenseType").value;
      const amount = parseFloat(document.getElementById("expenseAmount").value);
      const receipt = document.getElementById("expenseReceipt").files[0];

      if (type && amount > 0) {
        expenses.push({
          type,
          amount,
          date: new Date().toISOString().split("T")[0],
          receipt: receipt ? receipt.name : "None"
        });

        totalCash -= amount;
        saveToCSV();
        updateUI();

        document.getElementById("expenseType").value = "Stitching";
        document.getElementById("expenseAmount").value = "";
        document.getElementById("expenseReceipt").value = "";
      } else {
        alert("Please fill all fields correctly.");
      }
    }

    // Delete Transaction
    function deleteTransaction(index) {
      const password = prompt("Enter password to delete transaction:");
      if (password !== PASSWORD) {
        alert("Incorrect password!");
        return;
      }

      const allTransactions = [
        ...transactions,
        ...expenses.map(e => ({
          type: "Expense",
          category: "",
          quantity: "",
          amount: e.amount,
          date: e.date,
          name: e.type,
          receipt: e.receipt
        }))
      ].sort((a, b) => new Date(b.date) - new Date(a.date));

      const transaction = allTransactions[index];

      if (transaction.type === "Purchase") {
        const item = inventory.find(i => i.category === transaction.category);
        if (item) {
          item.quantity -= transaction.quantity;
          item.total_value -= transaction.amount;
          if (item.quantity <= 0) {
            inventory = inventory.filter(i => i.category !== transaction.category);
          }
        }
        totalCash += transaction.amount;
        transactions = transactions.filter(t => t !== transaction);
      } else if (transaction.type === "Sale") {
        const item = inventory.find(i => i.category === transaction.category);
        if (item) {
          item.quantity += transaction.quantity;
          item.total_value += transaction.amount;
        }
        totalCash -= transaction.amount;
        transactions = transactions.filter(t => t !== transaction);
      } else if (transaction.type === "Refund") {
        const item = inventory.find(i => i.category === transaction.category);
        if (item) {
          item.quantity -= transaction.quantity;
          item.total_value -= transaction.amount;
          if (item.quantity <= 0) {
            inventory = inventory.filter(i => i.category !== transaction.category);
          }
        }
        totalCash += transaction.amount;
        transactions = transactions.filter(t => t !== transaction);
      } else if (transaction.type === "Expense") {
        totalCash += transaction.amount;
        expenses = expenses.filter(e => e.date !== transaction.date || e.amount !== transaction.amount || e.type !== transaction.name);
      }

      saveToCSV();
      updateUI();
    }

    // Save to CSV (mock for local development)
    function saveToCSV() {
      console.log("Saving inventory:", inventory);
      console.log("Saving transactions:", transactions);
      console.log("Saving expenses:", expenses);
    }

    // Toggle Menu
    document.getElementById("menuToggle").addEventListener("click", () => {
      const menu = document.getElementById("menu");
      menu.classList.toggle("hidden");
    });

    // Toggle Transactions
    document.getElementById("toggleTransactions").addEventListener("click", (e) => {
      const list = document.getElementById("transactionsList");
      list.classList.toggle("hidden");
      e.target.textContent = list.classList.contains("hidden") ? "Show" : "Hide";
    });

    // Initialize
    loadData();
  </script>
</body>
</html>